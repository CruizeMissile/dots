#!/usr/bin/env bash

function main()
{
    trap 'echo Error: Operation Failed; return' ERR

    [ -z "$1" ] && echo "branch required"
    [ -z "$1" ] && echo "SHA/branch required, e.g 73bd32f" && exit 1
    git safereset
    echo ---- Checking out $1 ----
    git checkout $1
    echo ---- Restoring WIP if exists ----
    last_commit=$(git log -1 HEAD --pretty=format:%s)
    [ "$last_commit" == "WIP" ] && { echo Reverting WIP commit... && git reset --soft HEAD~1; } || echo No WIP commit
}

main "$@"
